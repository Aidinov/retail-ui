# Styleguides
## Перед разработкой
Установка программ и утилит, чтобы начать разработку

- git-lfs [git-lfs.github.com](https://git-lfs.github.com)
- Для Windows:
  - `yarn global add windows-build-tools`
- Для OS X:
  - `xcode-select --install`


## Процесс в целом
1. Начиная работать над задачей, создайте под неё ветку от текущего мастера. В этой ветке вы вносите правки в компонент или добавляете новый. 
2. Так как у нас open source библиотека, у нас нет отдельных тестовых площадок. Для проверки работы компонентов нужно будет локально запускать сторибук, стайлгайдист и тесты.
3. Чтобы изменения попали в мастер, нужно создать пулл-реквест (PR). Предложение сделать PR появится на странице гитхаба автоматически, если вы авторизованы и вами создан коммит в отдельной ветке. В тексте PR нужно указать ссылку на связанные с ним ишью - (фраза fix/fixes/close и номер ишью через решетку) и указать разработчиков на ревью — [Дмитрия Лазарева](https://github.com/wKich), [Егора Погадаева](https://github.com/zhzz), [Максима Пахомова](https://github.com/lossir) и тестировщика [Елену Шевченко](https://github.com/lenoraart). Если PR еще в работе пометьте его тегом `in progress`.
4. На новую функциональность должны быть написаны тесты, в них описаны основные сценарии.
5. Когда замечаний к коду нет, написаны тесты на новую функциональность, существующие тесты зеленые, ревьювер апрувит PR. Если за время разработки в мастере появились новые коммиты — нужно влить в ветку актуальный мастер.
6. Чтобы ветку можно было влить в мастер, должны быть пройдены все 3 проверки: 
    - Изменения одобрены ревьюерами
    - Пройдены все тесты
    - Влит актуальный мастер

После влития в мастер мы удаляем ветки. Если не получается переключится на ветку, скорее всего она уже влита — это видно по статусу PR.

## Работа с библиотекой
Сборка, запуск сторибука, стайлгайда для просмотра компонентов, запуск юнит и скриншотных тестов.
### Команды
- `yarn workspace retail-ui <command>`
  - `test` — Юнит тесты `Jest` + `Enzyme`
  - `lint` — `tsc --noEmit` + `tslint` + `eslint` + `stylelint` + `flow --check`
  - `build` — Сборка библиотеки
  - `storybook` — Storybook
  - `styleguide` — Styleguidist server
- `yarn workspace react-ui-testing <command>`
  - `start` — Старт приложения для интеграционных тестов (используется собранная версия библиотеки)
  - `test` — Интеграционные тесты с использованием `SeleniumTesting` (работает только во внутренней сети Контура)
- `yarn workspace react-ui-screenshot-tests test:gui` — Скриншотные тесты (для работы необходим API ключ от SauceLabs. Спросить можно у [Дмитрия Лазарева](https://github.com/wKich))

### Storybook
`yarn workspace retail-ui storybook`
[storybook.js.org](https://storybook.js.org) 

Дает возможность просматривать все компоненты проекта. Отображает «сторисы» которые созданы для каждого компонента, и описывают какое-то его состояние или взаимодействие с ним с разными параметрами и окружением. Все сторисы лежат рядом с компонентами в соответствующих директориях (`/Button/__stories__`). 

### Styleguidist
`yarn workspace retail-ui styleguide`
[react-styleguidist.js.org](https://react-styleguidist.js.org)

Стайлгайдист позволяет собрать документацию компонентов, описать их свойства и показать варианты использования. С помощью него генерируеся дока, на [tech.skbkontur.ru](http://tech.skbkontur.ru/react-ui/).

### Запуск юнит-тестов
`yarn workspace retail-ui test`
Все тесты лежат рядом с компонентами в соответствующих директориях (`/Button/__tests__`). 

### Запуск скриншотных тестов
`yarn workspace react-ui-screenshot-tests test:gui`

Нужно указывать `workspace react-ui-screenshot-tests`, чтобы запустить тесты из корневой директории. Из директории `react-ui-screenshot-tests` достаточно команды `test:gui`.

Для работы необходим API ключ от SauceLabs. Спросить можно у @wKich

Скриншотные тесты лежат в packages/react-ui-screenshot-tests. Запускаются через Selenium в браузере.

## Работа с репозиторием
После переключения на ветку необходимо выполнить `yarn`

### Git Commit Messages
В проекте используется [commitlint](http://marionebl.github.io/commitlint/#/). Формат сообщений [таков](https://conventionalcommits.org/). Для упрощения создания коммитов используйте команду `yarn commit`. 

К коммитам стоит относиться внимательно, т.к. на их основе будет формироваться `changelog` и версионирование библиотек.

### Pull request
Предложение сделать PR появится на [странице гитхаба](https://github.com/skbkontur/retail-ui/pulls)  автоматически, если вы авторизованы и вами создана отдельная ветка. 
(кажется тут можно написать ченить еще)

### Fork
`in progress`

### Upstream
`in progress`


## Code style, настройки IDE

Не используйте нижнее подчеркивание в начале имени приватных полей. Если заметите использование — нужно переименовывать (убирать подчеркивание) у всех компонентов, код которых вы трогаете.

### TypesScript
Используется `tslint` и `strict mode`. Не стоит злоупотреблять флагами `/* tslint:disable */`
